graph TD
    A[用户输入用户名] --> B[生成Device ID]
    B --> C[创建会话 sessionid]
    C --> D[用户语音输入]
    D --> E[编导判断是否适合结束]
    E -->|不适合| F[继续对话]
    E -->|适合| G[AI返回确认一个stream里有一个confirm_generate(done前面返回这个）判断不超过10次（面的第二次结束不了，如果已经聊了五轮了那就强烈暗示用户结束- -）（需要讨论）<br/>是否现在生成故事?]
    G --> H[前端显示两个按钮:<br/>1. 是的<br/>2. 再聊聊]
    H --> I{用户选择}
    I -->|再聊聊| F
    I -->|是的| J[后端处理生成]
    F --> K[编导继续对话]
    K --> E
    J --> L[返回编排文本]
    J --> M[返回JSON数据] # 返回一个数据结构： AI说了什么 用户的mp3的id是什么
    L --> N[前端展示]
    M --> O[生成MP3]
    O --> P[保存结果]
    P --> Q[我的生成页面查看]

    style G fill:#FFE4B5,stroke:#333
    style H fill:#FFE4B5,stroke:#333
    style J fill:#98FB98,stroke:#333
    style L fill:#87CEEB,stroke:#333
    style M fill:#87CEEB,stroke:#333

---

curl -X POST "http://124.220.31.71:3001/v1/sessions/create" -H "Content-Type: application/json" -d '{"username": "。"}' 


session_id每次chat/completions都需要header里传递（不方便可以改）

curl -X POST "http://124.220.31.71:3001/v1/chat/completions"   -H "session-id: 9d5ba717-e1b4-4b97-be55-123f32f30a5d"      -H "Content-Type: application/json"       -d '{"stream":true,
         "model": "claude-3-sonnet", 
         "messages": [{
            "role": "user",
            "id": "segment-id-1", # 对话开始时候就传这个参⚠️
            "content":"生成"
        }]                                                                
      }'


---
data: {"id": "chatcmpl-1766166031", "object": "chat.completion.chunk", "created": 1766166031, "model": "kimi-for-podcast", "choices": [{"index": 0, "delta": {"content": "4月28号，fisher骑着小摩托很开心，会场离他们家别墅很近。\n\n6月1号端午节，小朋友在体检走廊上遇到fisher，fisher送丈母娘体检。\n\n小朋友意识到，fisher为了他美满幸福的生活，那种看起来世俗意义上的养老，付出了代价。\n\n小朋友说，每个人都为自己的选择付出代价，没有哪种生活是好的。那一刻之后，主动性回到了小朋友身上。\n\n小朋友又说，半年时间，即使再见fisher，也不感觉难受了，又在打黑客松了。\n\n好的，我听到了，这一刻对你很重要。<comfirm_generate>是否现在生成故事？</comfirm_generate>"}, "finish_reason": null}], "session_id": "0f479c2e-fcfd-4d68-b0d7-8d5f9c52fc0f"}

comfirm_generate现在不从choices.delta.content里获取，流式返回时候返回一个 data: {"comfirm_generate": true}
出这个需要让用户进去1. 聊够了 2. 再多聊一会 的选择

现在是只要历史记录里有10次comfirm_generate就引导用户结束

---

后端处理生成还是独立的一个接口/api/podcast/generate
但是返回的是chat/complete格式的流式返回

可能还是有必要文档的：留存和review用：work in progress


sessionid必须传递，其他目前没有更多需要传入的参数
curl -X POST "http://124.220.31.71:3001/api/podcast/generate"     -H "Content-Type: application/json"    -d '{"session-id: "9d5ba717-e1b4-4b97-be55-123f32f30a5d"}'